<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/aop
                           http://www.springframework.org/schema/aop/spring-aop.xsd"
       default-init-method="init"
       default-destroy-method="destroy">

    <!--context:spring-configured/ -->
    <import resource="classpath*:springContext/applicationContext-dal.xml"/>
    <import resource="classpath*:springContext/applicationContext-shared.xml"/>
    <!--context:spring-configured/ -->
    <import resource="classpath*:springContext/applicationContext-allServices.xml"/>

    <bean name="narrationServiceBean" class="org.t2k.cgs.service.NarrationServiceImpl" />

    <bean name="contentValidatorBean" class="org.t2k.cgs.domain.usecases.packaging.ContentValidator" init-method="initValidators">
        <property name="active" value="true"/>
        <property name="courseJsonSchemaResource" value="classpath:schema/course_v7.json"/>
    </bean>

    <bean name="coursesDataServiceBean" class="org.t2k.cgs.service.CourseDataServiceImpl" />

    <bean name="lockService" class="org.t2k.cgs.service.LockServiceImpl">
        <property name="locksDao" ref="locksDao"/>
        <property name="courseDataService" ref="coursesDataServiceBean"/>
        <property name="tocItemsManager" ref="tocItemsManager"/>
    </bean>

    <bean name="transactionService" class="org.t2k.cgs.service.TransactionServiceImpl">
        <property name="transactionsDao" ref="transactionsDao"/>
    </bean>

    <bean name="lessonsDataServiceBean" class="org.t2k.cgs.domain.usecases.tocitem.TocItemDataServiceImpl">
        <property name="tocItemDao" ref="lessonsDao"/>
        <property name="lockService" ref="lockService"/>
        <property name="transactionService" ref="transactionService"/>
        <property name="sequenceService" ref="sequenceService"/>
        <property name="cleanupsDao" ref="cleanupsDao"/>
        <property name="contentValidator" ref="contentValidatorBean"/>
    </bean>

    <bean name="assessmentsDataServiceBean" class="org.t2k.cgs.domain.usecases.tocitem.TocItemDataServiceImpl">
        <property name="tocItemDao" ref="assessmentsDao"/>
        <property name="lockService" ref="lockService"/>
        <property name="transactionService" ref="transactionService"/>
        <property name="sequenceService" ref="sequenceService"/>
        <property name="cleanupsDao" ref="cleanupsDao"/>
        <property name="contentValidator" ref="contentValidatorBean"/>
    </bean>

    <bean name="tocItemsManager" class="org.t2k.cgs.service.tocitem.TocItemsManagerImpl">
        <property name="assessmentsDataService" ref="assessmentsDataServiceBean"/>
        <property name="lessonsDataService" ref="lessonsDataServiceBean"/>
        <property name="lockService" ref="lockService"/>
    </bean>

    <bean name="importLessonService" class="org.t2k.cgs.service.tocitem.ImportTocItemServiceImpl"/>

    <!--bean for assets upload and download management-->
    <bean name="cmsService" class="org.t2k.cgs.service.CmsServiceImpl">
        <property name="configuration" ref="t2kConfig"/>
        <property name="fileDao" ref="fileDao"/>
    </bean>

    <!-- Skills / Standards service -->
    <bean name="StandardsService" class="org.t2k.cgs.org.t2k.cgs.service.standards.StandardsServiceImpl">
        <property name="standardsDao" ref="standardsDao"/>
        <property name="lockService" ref="lockService"/>
        <property name="courseDataService" ref="coursesDataServiceBean"/>
        <property name="tocItemsManager" ref="tocItemsManager"/>
    </bean>

    <!-- Publisher service -->
    <bean name="publisherService" class="org.t2k.cgs.service.AccountServiceImpl">
        <property name="publisherDao" ref="publisherDao"/>
        <property name="groupDataValidator">
            <bean class="org.t2k.cgs.domain.usecases.publish.validationataValidator" init-method="initValidators">
                <property name="active" value="true"/>
                <property name="accountDataJsonSchemaResource" value="classpath:schema/groupSchema.json" />
            </bean>
        </property>
        <property name="accountDataValidator">
            <bean class="org.t2k.cgs.domain.usecases.publisher.BaseAccountDataValidator" init-method="initValidators">
                <property name="active" value="true"/>
                <property name="accountDataJsonSchemaResource" value="classpath:schema/accountSchema.json"/>
            </bean>
        </property>
        <property name="userService" ref="userService"/>
    </bean>

    <bean class="org.t2k.cgs.configuration.ClientConfigurationServiceImpl" factory-bean="clientConfigurationService"
          factory-method="getConfiguration" scope="request">
        <aop:scoped-proxy/>
    </bean>

    <bean class="org.t2k.cgs.security.AuthenticationServiceImpl" factory-bean="authenticationService"
          factory-method="getAuthenticationData" scope="request">
        <aop:scoped-proxy/>
    </bean>

    <bean name="authenticationService" class="org.t2k.cgs.security.AuthenticationServiceImpl" scope="singleton">
    </bean>

    <bean name="clientConfigurationService" class="org.t2k.cgs.configuration.ClientConfigurationServiceImpl" scope="singleton">
        <property name="versionService" ref="versionService"/>
        <property name="contentValidator" ref="contentValidatorBean"/>
    </bean>

    <bean name="packagingService" class="org.t2k.cgs.service.packaging.PackagingServiceImpl">
        <property name="packagingDao" ref="packagingDao"/>
    </bean>

    <bean name="appletService" class="org.t2k.cgs.service.AppletServiceImpl">
        <property name="gcrClient" ref="gcrClient"/>
        <property name="appletDao" ref="appletDao"/>
        <property name="lockService" ref="lockService"/>
        <property name="cmsService" ref="cmsService"/>
        <property name="tocItemsManager" ref="tocItemsManager"/>
        <property name="sequenceService" ref="sequenceService"/>
    </bean>

    <bean name="packageManager" class="org.t2k.cgs.service.packaging.PackageManagerImpl" init-method="init">
        <property name="coursesDao" ref="coursesDao"/>
        <property name="packagingService" ref="packagingService"/>
        <property name="configuration" ref="t2kConfig"/>
        <property name="transactionService" ref="transactionService"/>
    </bean>

    <bean name="exportImportService" class="org.t2k.cgs.service.ExportImportServiceImpl" init-method="init">
        <property name="coursesDao" ref="coursesDao"/>
        <property name="lessonsDao" ref="lessonsDao"/>
        <property name="assessmentsDao" ref="assessmentsDao"/>
        <property name="configuration" ref="t2kConfig"/>
        <property name="lockService" ref="lockService"/>
        <property name="sequenceService" ref="sequenceService"/>
        <property name="courseDataService" ref="coursesDataServiceBean"/>
        <property name="appletDao" ref="appletDao"/>
        <property name="publisherDao" ref="publisherDao"/>
        <property name="standardsDao" ref="standardsDao"/>
        <property name="jobService" ref="jobsServiceBean"/>
        <property name="fileDao" ref="fileDao"/>
        <property name="tocItemDataService" ref="tocItemDataService"/>
        <property name="eBookService" ref="eBookService"/>
        <property name="filesUtils" ref="filesUtils"/>
        <property name="versionService" ref="versionService"/>
    </bean>

    <bean name="catalogueUploader" class="org.t2k.cgs.service.packaging.uploaders.CatalogueUploader">
        <property name="configuration" ref="t2kConfig"/>
    </bean>

    <bean name="blossomUploader" class="org.t2k.cgs.service.packaging.uploaders.BlossomUploader"/>

    <bean name="manifestHandlerWithSha1NameChangesAndWithResourceExclusion" class="org.t2k.cgs.service.packaging.ManifestHandlerImpl">
        <property name="doChangeFileNamesToSha1" value="true"/>
        <property name="doCleanExcludedResourcesFromManifest" value="true"/>
    </bean>

    <bean name="manifestHandlerWithSha1NameChangesAndWithoutResourceExclusion" class="org.t2k.cgs.service.packaging.ManifestHandlerImpl">
        <property name="doChangeFileNamesToSha1" value="true"/>
        <property name="doCleanExcludedResourcesFromManifest" value="false"/>
    </bean>

    <bean name="manifestHandlerWithoutSha1NameChangesAndWithoutResourceExclusion" class="org.t2k.cgs.service.packaging.ManifestHandlerImpl">
        <property name="doChangeFileNamesToSha1" value="false"/>
        <property name="doCleanExcludedResourcesFromManifest" value="false"/>
    </bean>

    <bean name="manifestHandlerWithoutSha1NameChangesAndWithResourceExclusion" class="org.t2k.cgs.service.packaging.ManifestHandlerImpl">
        <property name="doChangeFileNamesToSha1" value="false"/>
        <property name="doCleanExcludedResourcesFromManifest" value="true"/>
    </bean>

    <bean name="tocItemsHandlerImplWithSha1NameChanges" class="org.t2k.cgs.service.packaging.TocItemsHandlerImpl" >
        <property name="changeFileNamesToSha1" value="true"/>
    </bean>

    <bean name="tocItemsHandlerImplWithoutSha1NameChanges" class="org.t2k.cgs.service.packaging.TocItemsHandlerImpl" >
        <property name="changeFileNamesToSha1" value="false"/>
    </bean>

    <!-- Version service -->
    <bean name="versionProperties" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="location" value="classpath:config/version.properties"/>
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
    </bean>

    <bean name="versionService" class="org.t2k.cgs.service.VersionServiceImpl"/>

    <bean name="userService" class="org.t2k.cgs.service.UserServiceImpl">
        <property name="usersDao" ref="usersDao"/>
        <property name="uniqueIdDao" ref="uniqueIdDao"/>
        <property name="newUserValidator">
            <bean class="org.t2k.cgs.domain.usecases.user.validation.NewUserValidator"/>
        </property>
        <property name="updateUserValidator">
            <bean class="org.t2k.cgs.domain.usecases.user.validation.UpdateUserValidator"/>
        </property>
    </bean>

    <bean name="jobsServiceBean" class="org.t2k.cgs.service.JobServiceImpl"/>
    <bean name="contentTreeService" class="org.t2k.cgs.service.tocitem.ContentTreeServiceImpl"/>
    <bean name="ttsProviderService" class="org.t2k.cgs.service.TextToSpeechProviderServiceImpl"/>
    <bean name="scormPackageZipper" class="org.t2k.cgs.domain.usecases.packaging.zippers.ScormPackageZipper" />
    <bean name="standAlonePackageZipper" class="org.t2k.cgs.service.packaging.StandAlonePackageZipper" />

    <bean name="blossomLessonExecutor" class="org.t2k.cgs.domain.usecases.packaging.executors.BlossomExecutor">
        <property name="manifestHandler" ref="manifestHandlerWithoutSha1NameChangesAndWithResourceExclusion"/>
        <property name="tocItemsHandler" ref="tocItemsHandlerImplWithoutSha1NameChanges"/>
    </bean>

    <bean name="blossomCoursesExecutor" class="org.t2k.cgs.domain.usecases.packaging.executors.BlossomExecutor">
        <property name="manifestHandler" ref="manifestHandlerWithoutSha1NameChangesAndWithoutResourceExclusion"/>
        <property name="tocItemsHandler" ref="tocItemsHandlerImplWithoutSha1NameChanges"/>
    </bean>


    <bean name="scormExecutor" class="org.t2k.cgs.domain.usecases.packaging.executors.ScormExecutor">
        <property name="manifestHandler" ref="manifestHandlerWithoutSha1NameChangesAndWithResourceExclusion"/>
        <property name="tocItemsHandler" ref="tocItemsHandlerImplWithoutSha1NameChanges"/>
    </bean>

    <bean name="catalogueExecutor" class="org.t2k.cgs.domain.usecases.packaging.executors.CatalogueExecutor">
        <property name="manifestHandler" ref="manifestHandlerWithSha1NameChangesAndWithoutResourceExclusion"/>
        <property name="tocItemsHandler" ref="tocItemsHandlerImplWithoutSha1NameChanges"/>
    </bean>

    <bean name="standAloneExecutor" class="org.t2k.cgs.domain.usecases.packaging.executors.StandAloneExecutor">
        <property name="manifestHandler" ref="manifestHandlerWithoutSha1NameChangesAndWithoutResourceExclusion"/>
        <property name="tocItemsHandler" ref="tocItemsHandlerImplWithoutSha1NameChanges"/>
    </bean>

    <bean name="packageExcutorsFactory" class="org.t2k.cgs.service.packaging.PackageExecutorsFactory" />
    <bean name="schemaHandler" class="org.t2k.cgs.service.packaging.SchemaHandlerImpl" />
    <bean name="packageHandler" class="org.t2k.cgs.service.packaging.PackageHandlerImpl" scope="prototype"/>

</beans>